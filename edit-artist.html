<html>

<head>
 <title>
   new - demo
 </title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<script>
// contact
function getParameterByName(name, url) {
    if (!url) {
      url = window.location.href;
    }
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}
function TokenObject(entityKey) {
    this.entityKey = entityKey;
    this.tokenint = sessionStorage.token;
    this.toJsonString = function () { return JSON.stringify(this); };
};

function ArtistObject(myNombre, entityKey) {
    this.nombre = myNombre;
    this.entityKey = entityKey;
    this.token = sessionStorage.token;
    this.urlImage = sessionStorage.urlImage;
    this.toJsonString = function () { return JSON.stringify(this); };

};

function getArtist()
{
  try
  {


    //alert("token : " + sessionStorage.token);

    var ek = getParameterByName('key'); // "lorem"
    var myData = new TokenObject(ek);
    
    jQuery.ajax({
        type: "POST",
        url: "http://localhost:8080/_ah/api/artist_api/v1/artist/get",
        data: myData.toJsonString(),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function (response) {
            artists = response;
            artists.data.forEach(function (artist) 
            {
                $("#nombre").empty();
                $("#url_photo").empty();
                $("#nombre").val(artist.nombre);
                $("#url_photo").val(artist.urlImage);
                document.getElementById("preview").src=artist.urlImage;
            });
        },
        error: function (error) {            
            // error handler
            alert("error :" + error.message)
        }

       });
   }
   catch(error)
   {
    alert(error);
   }

}

function editArtist()
{
    try
  
{

    var ek = getParameterByName('key'); // "lorem"
    var myData = new ArtistObject(
     $("#nombre").val(),
     ek
     );
    alert(myData.toJsonString());

     jQuery.ajax({
           type: "POST",
           url: "http://localhost:8080/_ah/api/artist_api/v1/artist/update",
           data: myData.toJsonString(),
           contentType: "application/json; charset=utf-8",
           dataType: "json",
           success: function (response) {
                // do something
                alert (response.code + " " + response.message);
           },
       
           error: function (error) {            
                // error handler
                alert("error :" + error.message)
           }

       });

   }
   catch(error)
   {
    alert(error);
   }

}

function uploadDemo()

{

    var file_data = $("#uploaded_file").prop("files")[0];
    var form_data = new FormData();
    form_data.append("uploaded_file", file_data)

    jQuery.support.cors = true;
    try
    {
     $.ajax({
                url: "http://localhost:8080/up",
                dataType: 'text',
                cache: false,
                contentType: false,
                processData: false,
                data: form_data,
                type: 'post',
                crossDomain: true,
                success: function(response){

                                document.getElementById("preview").src=response;

                                sessionStorage.urlImage = response;

                                document.getElementById("url_photo").value = response;
                }
      });
    }
    catch(e)
    {
      alert("error : " +  e);
     }
}


</script>

</head>
<body onload="getArtist();">


<h1> Add demo</h1>

nombre: <input type="text" id="nombre" value="" /> <br>

 <div class="col-md-offset-2 col-md-8 col-sm-offset-1 col-sm-10 text-center">
              <label for="exampleInputEmail1"><i>Foto</i></label>
               <br>
               <img  src="" alt="Image preview" id="preview" style="width:128px;height:128px;" >
               <br>
               <input type="text" id="url_photo">
               <br><input onchange="uploadDemo()" type="file"  id="uploaded_file" name="uploaded_file">
              </div>
<button onclick="editArtist()"> Guardar </button> 
</body>
</html>
